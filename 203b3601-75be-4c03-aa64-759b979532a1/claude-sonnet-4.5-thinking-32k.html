<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Centrix81 - Saharsh's School Escape</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100vh;
        }
        
        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 100;
        }
        
        #stats {
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .stat-item {
            margin: 5px 0;
        }
        
        .stat-label {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .danger {
            color: #f44336;
        }
        
        .success {
            color: #4CAF50;
        }
        
        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 15px;
            color: white;
            text-align: center;
            max-width: 500px;
            z-index: 200;
        }
        
        #instructions h1 {
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        #instructions p {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        #startBtn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        #startBtn:hover {
            background: #45a049;
        }
        
        #playerAvatar {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            z-index: 100;
        }
        
        #message {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 15px 30px;
            border-radius: 10px;
            color: white;
            font-size: 20px;
            display: none;
            z-index: 150;
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 15px;
            color: white;
            text-align: center;
            display: none;
            z-index: 200;
        }
        
        #gameOver h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .key {
            display: inline-block;
            background: #333;
            padding: 5px 10px;
            border-radius: 3px;
            margin: 0 3px;
            border: 1px solid #666;
        }
    </style>
</head>
<body>
    <div id="hud">
        <div id="stats">
            <div class="stat-item"><span class="stat-label">Gaming Score:</span> <span id="gameScore" class="success">0</span></div>
            <div class="stat-item"><span class="stat-label">Classes Failed:</span> <span id="classesFailed" class="danger">0</span></div>
            <div class="stat-item"><span class="stat-label">GPA:</span> <span id="gpa">4.0</span></div>
            <div class="stat-item"><span class="stat-label">Computers Found:</span> <span id="computersFound">0/5</span></div>
        </div>
    </div>
    
    <img id="playerAvatar" src="https://asset-cdn.schoology.com/system/files/imagecache/profile_big/pictures/picture-c0b09cdead19788fb0f8be0d53b5c572_68c34cd700b90.jpg" alt="Saharsh">
    
    <div id="message"></div>
    
    <div id="instructions">
        <h1>ðŸŽ® Secure Centrix81 ðŸŽ®</h1>
        <h2>Saharsh's School Escape</h2>
        <p>You are Saharsh, a student more interested in gaming than academics!</p>
        <p><strong>Goal:</strong> Navigate the school, avoid classrooms (red cubes), and find computers (green cubes) to play games on!</p>
        <p><strong>Controls:</strong></p>
        <p><span class="key">W</span><span class="key">A</span><span class="key">S</span><span class="key">D</span> - Move around</p>
        <p><span class="key">Mouse</span> - Look around</p>
        <p><span class="key">E</span> - Interact with computers</p>
        <p><strong>Warning:</strong> Getting too close to classrooms will lower your GPA!</p>
        <button id="startBtn">Start Game</button>
    </div>
    
    <div id="gameOver">
        <h1 id="gameOverTitle">Game Over!</h1>
        <p id="gameOverText"></p>
        <p id="finalScore"></p>
        <button id="restartBtn" style="margin-top: 20px; padding: 15px 30px; font-size: 18px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Play Again</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script>
        // Game variables
        let scene, camera, renderer, player;
        let gameStarted = false;
        let gameScore = 0;
        let classesFailed = 0;
        let gpa = 4.0;
        let computersFound = 0;
        let totalComputers = 5;
        
        // Movement
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        const speed = 0.15;
        
        // Mouse look
        let mouseX = 0, mouseY = 0;
        let yaw = 0, pitch = 0;
        let isPointerLocked = false;
        
        // Game objects
        let classrooms = [];
        let computers = [];
        let walls = [];
        
        // Initialize
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 0, 50);
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);
            renderer.domElement.id = 'gameCanvas';
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(100, 100);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x808080,
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Create school environment
            createSchoolEnvironment();
            
            // Player (invisible, camera is the player)
            player = new THREE.Object3D();
            player.position.set(0, 1.6, 0);
            player.add(camera);
            scene.add(player);
            
            // Event listeners
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            
            window.addEventListener('resize', onWindowResize);
            
            animate();
        }
        
        function createSchoolEnvironment() {
            // Create classroom zones (red danger zones)
            const classroomPositions = [
                { x: -15, z: -15 },
                { x: 15, z: -15 },
                { x: -15, z: 15 },
                { x: 15, z: 15 },
                { x: 0, z: -20 }
            ];
            
            classroomPositions.forEach(pos => {
                const geometry = new THREE.BoxGeometry(4, 3, 4);
                const material = new THREE.MeshStandardMaterial({ 
                    color: 0xff0000,
                    transparent: true,
                    opacity: 0.7,
                    emissive: 0xff0000,
                    emissiveIntensity: 0.2
                });
                const classroom = new THREE.Mesh(geometry, material);
                classroom.position.set(pos.x, 1.5, pos.z);
                classroom.castShadow = true;
                classroom.userData.type = 'classroom';
                scene.add(classroom);
                classrooms.push(classroom);
                
                // Add label
                createLabel('CLASS', classroom.position, 0xff0000);
            });
            
            // Create computer stations (green goal zones)
            const computerPositions = [
                { x: -8, z: 0 },
                { x: 8, z: 0 },
                { x: 0, z: -8 },
                { x: 0, z: 8 },
                { x: -20, z: 0 }
            ];
            
            computerPositions.forEach(pos => {
                const geometry = new THREE.BoxGeometry(2, 2, 2);
                const material = new THREE.MeshStandardMaterial({ 
                    color: 0x00ff00,
                    emissive: 0x00ff00,
                    emissiveIntensity: 0.3
                });
                const computer = new THREE.Mesh(geometry, material);
                computer.position.set(pos.x, 1, pos.z);
                computer.castShadow = true;
                computer.userData.type = 'computer';
                computer.userData.collected = false;
                scene.add(computer);
                computers.push(computer);
                
                // Add label
                createLabel('PC', computer.position, 0x00ff00);
            });
            
            // Create walls around the perimeter
            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            
            // North wall
            const northWall = new THREE.Mesh(new THREE.BoxGeometry(100, 5, 1), wallMaterial);
            northWall.position.set(0, 2.5, -30);
            scene.add(northWall);
            walls.push(northWall);
            
            // South wall
            const southWall = new THREE.Mesh(new THREE.BoxGeometry(100, 5, 1), wallMaterial);
            southWall.position.set(0, 2.5, 30);
            scene.add(southWall);
            walls.push(southWall);
            
            // East wall
            const eastWall = new THREE.Mesh(new THREE.BoxGeometry(1, 5, 60), wallMaterial);
            eastWall.position.set(30, 2.5, 0);
            scene.add(eastWall);
            walls.push(eastWall);
            
            // West wall
            const westWall = new THREE.Mesh(new THREE.BoxGeometry(1, 5, 60), wallMaterial);
            westWall.position.set(-30, 2.5, 0);
            scene.add(westWall);
            walls.push(westWall);
        }
        
        function createLabel(text, position, color) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 128;
            
            context.fillStyle = `#${color.toString(16).padStart(6, '0')}`;
            context.font = 'Bold 48px Arial';
            context.textAlign = 'center';
            context.fillText(text, 128, 80);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.position.set(position.x, position.y + 3, position.z);
            sprite.scale.set(4, 2, 1);
            scene.add(sprite);
        }
        
        function startGame() {
            document.getElementById('instructions').style.display = 'none';
            gameStarted = true;
            
            // Request pointer lock
            renderer.domElement.requestPointerLock = renderer.domElement.requestPointerLock || 
                                                      renderer.domElement.mozRequestPointerLock;
            renderer.domElement.requestPointerLock();
            
            document.addEventListener('pointerlockchange', onPointerLockChange);
            document.addEventListener('mousemove', onMouseMove);
        }
        
        function restartGame() {
            location.reload();
        }
        
        function onPointerLockChange() {
            isPointerLocked = document.pointerLockElement === renderer.domElement;
        }
        
        function onMouseMove(event) {
            if (!isPointerLocked) return;
            
            mouseX = event.movementX || 0;
            mouseY = event.movementY || 0;
            
            yaw -= mouseX * 0.002;
            pitch -= mouseY * 0.002;
            pitch = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, pitch));
        }
        
        function onKeyDown(event) {
            switch(event.code) {
                case 'KeyW': moveForward = true; break;
                case 'KeyS': moveBackward = true; break;
                case 'KeyA': moveLeft = true; break;
                case 'KeyD': moveRight = true; break;
                case 'KeyE': interactWithNearestComputer(); break;
            }
        }
        
        function onKeyUp(event) {
            switch(event.code) {
                case 'KeyW': moveForward = false; break;
                case 'KeyS': moveBackward = false; break;
                case 'KeyA': moveLeft = false; break;
                case 'KeyD': moveRight = false; break;
            }
        }
        
        function updateMovement() {
            if (!gameStarted) return;
            
            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveLeft) - Number(moveRight);
            direction.normalize();
            
            // Apply rotation to movement direction
            const rotatedDirection = direction.clone();
            rotatedDirection.applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);
            
            velocity.x = rotatedDirection.x * speed;
            velocity.z = rotatedDirection.z * speed;
            
            // Update player position with collision detection
            const newPosition = player.position.clone();
            newPosition.x += velocity.x;
            newPosition.z += velocity.z;
            
            // Simple boundary collision
            if (Math.abs(newPosition.x) < 29 && Math.abs(newPosition.z) < 29) {
                player.position.copy(newPosition);
            }
            
            // Update camera rotation
            camera.rotation.order = 'YXZ';
            camera.rotation.y = 0;
            camera.rotation.x = pitch;
            player.rotation.y = yaw;
        }
        
        function checkProximity() {
            if (!gameStarted) return;
            
            // Check proximity to classrooms
            classrooms.forEach(classroom => {
                const distance = player.position.distanceTo(classroom.position);
                if (distance < 5) {
                    // Too close to class!
                    if (Math.random() < 0.01) { // Small chance each frame
                        classesFailed++;
                        gpa = Math.max(0, gpa - 0.2);
                        showMessage('Caught near class! GPA -0.2', 'danger');
                        
                        if (gpa <= 0) {
                            endGame(false);
                        }
                    }
                    
                    // Make classroom pulse
                    classroom.material.emissiveIntensity = 0.5;
                } else {
                    classroom.material.emissiveIntensity = 0.2;
                }
            });
            
            // Check proximity to computers
            computers.forEach(computer => {
                if (computer.userData.collected) return;
                
                const distance = player.position.distanceTo(computer.position);
                if (distance < 3) {
                    // Make computer pulse to show it's interactable
                    computer.rotation.y += 0.02;
                    computer.material.emissiveIntensity = 0.5 + Math.sin(Date.now() * 0.005) * 0.2;
                } else {
                    computer.material.emissiveIntensity = 0.3;
                }
            });
        }
        
        function interactWithNearestComputer() {
            let nearestComputer = null;
            let minDistance = 3;
            
            computers.forEach(computer => {
                if (computer.userData.collected) return;
                
                const distance = player.position.distanceTo(computer.position);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestComputer = computer;
                }
            });
            
            if (nearestComputer) {
                nearestComputer.userData.collected = true;
                nearestComputer.material.color.setHex(0x666666);
                nearestComputer.material.emissive.setHex(0x333333);
                computersFound++;
                gameScore += 100;
                gpa = Math.min(4.0, gpa + 0.1); // Small GPA boost for gaming skills
                showMessage('Found a gaming PC! +100 points! ðŸŽ®', 'success');
                
                if (computersFound >= totalComputers) {
                    endGame(true);
                }
            }
        }
        
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.style.color = type === 'danger' ? '#f44336' : '#4CAF50';
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 2000);
        }
        
        function updateHUD() {
            document.getElementById('gameScore').textContent = gameScore;
            document.getElementById('classesFailed').textContent = classesFailed;
            document.getElementById('gpa').textContent = gpa.toFixed(1);
            document.getElementById('computersFound').textContent = `${computersFound}/${totalComputers}`;
            
            // Color code GPA
            const gpaEl = document.getElementById('gpa');
            if (gpa >= 3.0) {
                gpaEl.style.color = '#4CAF50';
            } else if (gpa >= 2.0) {
                gpaEl.style.color = '#FFC107';
            } else {
                gpaEl.style.color = '#f44336';
            }
        }
        
        function endGame(won) {
            gameStarted = false;
            const gameOverEl = document.getElementById('gameOver');
            const titleEl = document.getElementById('gameOverTitle');
            const textEl = document.getElementById('gameOverText');
            const scoreEl = document.getElementById('finalScore');
            
            if (won) {
                titleEl.textContent = 'ðŸŽ® Victory! ðŸŽ®';
                titleEl.style.color = '#4CAF50';
                textEl.textContent = 'Saharsh found all the gaming PCs and became a Secure Centrix legend!';
            } else {
                titleEl.textContent = 'ðŸ“š Academic Probation! ðŸ“š';
                titleEl.style.color = '#f44336';
                textEl.textContent = 'Your GPA dropped to 0.0. Time to hit the books... or maybe just one more game?';
            }
            
            scoreEl.innerHTML = `
                <strong>Final Stats:</strong><br>
                Gaming Score: ${gameScore}<br>
                Computers Found: ${computersFound}/${totalComputers}<br>
                Classes Failed: ${classesFailed}<br>
                Final GPA: ${gpa.toFixed(1)}
            `;
            
            gameOverEl.style.display = 'block';
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            updateMovement();
            checkProximity();
            updateHUD();
            
            // Animate computers
            computers.forEach(computer => {
                if (!computer.userData.collected) {
                    computer.position.y = 1 + Math.sin(Date.now() * 0.001 + computer.position.x) * 0.2;
                }
            });
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Start the game
        init();
    </script>
</body>
</html>
