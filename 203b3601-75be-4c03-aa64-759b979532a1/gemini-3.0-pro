<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saharsh's Secure Centrix Run</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
            }
        }
    </script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Courier New', Courier, monospace; background-color: #1a1a1a; }
        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }
        #score-board {
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
            font-size: 24px;
            font-weight: bold;
        }
        #gpa-container {
            width: 300px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #fff;
            border-radius: 10px;
            padding: 5px;
        }
        #gpa-bar {
            height: 20px;
            width: 100%;
            background: linear-gradient(90deg, red, yellow, green);
            transition: width 0.2s;
        }
        #gpa-text {
            color: white;
            text-align: center;
            margin-top: 5px;
        }
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 40px;
            text-align: center;
            border: 2px solid #0f0;
            border-radius: 15px;
            display: none;
            pointer-events: auto;
            box-shadow: 0 0 20px #0f0;
        }
        .btn {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .btn:hover {
            background: #fff;
        }
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #0f0;
            pointer-events: auto;
            z-index: 10;
        }
        h1 { text-shadow: 0 0 10px #0f0; margin-bottom: 10px; }
        p { color: #ccc; max-width: 600px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="ui-container">
        <div id="score-board">
            <div>SECURE CENTRIX ACCESS: <span id="score">0</span>%</div>
            <div style="font-size: 16px; color: #aaa;">Class Status: <span id="status">Bored</span></div>
        </div>
        <div id="gpa-container">
            <div id="gpa-bar"></div>
            <div id="gpa-text">GPA: 4.0</div>
        </div>
    </div>

    <div id="start-screen">
        <h1 class="text-4xl font-bold">SAHARSH'S SECURE CENTRIX 81 RUN</h1>
        <p class="text-lg">You are Saharsh. You are failing your classes because you can't stop playing on Secure Centrix.</p>
        <p>Collect <strong>Green Laptops</strong> to boost your gaming score.</p>
        <p>Avoid <strong>RED BLOCKS (Grades)</strong> or your GPA will drop!</p>
        <p>Use <strong>LEFT</strong> and <strong>RIGHT</strong> arrows or <strong>A</strong> and <strong>D</strong> to move.</p>
        <button class="btn" id="start-btn">Start Playing</button>
    </div>

    <div id="game-over">
        <h2 class="text-3xl font-bold text-red-500 mb-4">ACADEMIC PROBATION</h2>
        <p class="mb-4">Your GPA hit 0.0. You have been expelled.</p>
        <p>Final Secure Centrix Score: <span id="final-score">0</span></p>
        <button class="btn" id="restart-btn">Try Again</button>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // Configuration
        const SAHARSH_IMG_URL = "https://asset-cdn.schoology.com/system/files/imagecache/profile_big/pictures/picture-c0b09cdead19788fb0f8be0d53b5c572_68c34cd700b90.jpg";
        const LANE_WIDTH = 2.5;
        const SPEED_INITIAL = 0.5; // Moving world speed
        const OBSTACLE_SPAWN_RATE = 80; // Frames
        
        // Game State
        let scene, camera, renderer;
        let player;
        let lanes = [-LANE_WIDTH, 0, LANE_WIDTH];
        let currentLane = 1; // 0: Left, 1: Middle, 2: Right
        let targetX = 0;
        let obstacles = [];
        let collectibles = [];
        let gameActive = false;
        let score = 0;
        let gpa = 4.0;
        let speed = SPEED_INITIAL;
        let frameCount = 0;
        let particles = [];

        // DOM Elements
        const scoreEl = document.getElementById('score');
        const statusEl = document.getElementById('status');
        const gpaBar = document.getElementById('gpa-bar');
        const gpaText = document.getElementById('gpa-text');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreEl = document.getElementById('final-score');
        const startScreen = document.getElementById('start-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        // Texture Loader
        const textureLoader = new THREE.TextureLoader();
        const saharshTexture = textureLoader.load(SAHARSH_IMG_URL);
        
        // Init
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            scene.fog = new THREE.FogExp2(0x111111, 0.08);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 3, 6);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 1);
            dirLight.position.set(5, 10, 7);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(20, 1000);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x222222,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.z = -400;
            floor.receiveShadow = true;
            scene.add(floor);

            // Grid Helper for "Digital" feel
            const gridHelper = new THREE.GridHelper(200, 100, 0x00ff00, 0x003300);
            gridHelper.position.y = 0.01;
            gridHelper.position.z = -50;
            scene.add(gridHelper);

            // Moving grid logic helper
            window.gridHelper = gridHelper;

            // Player
            createPlayer();

            // Listeners
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('keydown', handleInput);
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', resetGame);
            
            animate();
        }

        function createPlayer() {
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            // Apply Saharsh texture to front face, others dark
            const materials = [
                new THREE.MeshStandardMaterial({ color: 0x333333 }), // Right
                new THREE.MeshStandardMaterial({ color: 0x333333 }), // Left
                new THREE.MeshStandardMaterial({ color: 0x333333 }), // Top
                new THREE.MeshStandardMaterial({ color: 0x333333 }), // Bottom
                new THREE.MeshStandardMaterial({ map: saharshTexture }), // Front
                new THREE.MeshStandardMaterial({ color: 0x333333 })  // Back
            ];
            
            player = new THREE.Mesh(geometry, materials);
            player.position.y = 0.5;
            player.castShadow = true;
            scene.add(player);
        }

        function spawnObstacle() {
            // Choose lane
            const laneIndex = Math.floor(Math.random() * 3);
            const xPos = lanes[laneIndex];

            // Create "F" Grade (Red Block)
            const geometry = new THREE.BoxGeometry(1.5, 2, 0.5);
            const material = new THREE.MeshStandardMaterial({ 
                color: 0xff0000, 
                emissive: 0x550000 
            });
            const obstacle = new THREE.Mesh(geometry, material);
            obstacle.position.set(xPos, 1, -50);
            obstacle.castShadow = true;
            
            // Tag it
            obstacle.userData = { type: 'obstacle', active: true };
            
            scene.add(obstacle);
            obstacles.push(obstacle);
        }

        function spawnCollectible() {
            // Try to spawn in a different lane than last obstacle if possible
            const laneIndex = Math.floor(Math.random() * 3);
            const xPos = lanes[laneIndex];

            // Create "Secure Centrix" Laptop (Green Box)
            const geometry = new THREE.BoxGeometry(0.8, 0.1, 0.6); // Laptop base
            const screenGeo = new THREE.BoxGeometry(0.8, 0.6, 0.05); // Screen
            
            const material = new THREE.MeshStandardMaterial({ 
                color: 0x00ff00,
                emissive: 0x004400
            });

            const group = new THREE.Group();
            const base = new THREE.Mesh(geometry, material);
            const screen = new THREE.Mesh(screenGeo, material);
            screen.position.y = 0.35;
            screen.position.z = -0.3;
            screen.rotation.x = -0.2;

            group.add(base);
            group.add(screen);
            
            group.position.set(xPos, 0.5, -50);
            group.userData = { type: 'collectible', active: true };
            
            scene.add(group);
            collectibles.push(group);
        }

        function handleInput(e) {
            if (!gameActive) return;

            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
                if (currentLane > 0) {
                    currentLane--;
                    targetX = lanes[currentLane];
                }
            } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
                if (currentLane < 2) {
                    currentLane++;
                    targetX = lanes[currentLane];
                }
            }
        }

        function startGame() {
            startScreen.style.display = 'none';
            gameActive = true;
            score = 0;
            gpa = 4.0;
            speed = SPEED_INITIAL;
            updateUI();
        }

        function resetGame() {
            // Clear objects
            obstacles.forEach(o => scene.remove(o));
            collectibles.forEach(c => scene.remove(c));
            particles.forEach(p => scene.remove(p));
            
            obstacles = [];
            collectibles = [];
            particles = [];

            gameOverScreen.style.display = 'none';
            
            // Reset Position
            currentLane = 1;
            targetX = 0;
            player.position.x = 0;
            
            startGame();
        }

        function gameOver() {
            gameActive = false;
            gameOverScreen.style.display = 'block';
            finalScoreEl.innerText = score;
        }

        function updateUI() {
            scoreEl.innerText = score;
            gpaText.innerText = "GPA: " + gpa.toFixed(1);
            const percentage = (gpa / 4.0) * 100;
            gpaBar.style.width = percentage + "%";
            
            if (gpa > 3.0) {
                gpaBar.style.background = "linear-gradient(90deg, green, lime)";
                statusEl.innerText = "Honor Roll";
                statusEl.style.color = "lime";
            } else if (gpa > 2.0) {
                gpaBar.style.background = "linear-gradient(90deg, yellow, orange)";
                statusEl.innerText = "Struggling";
                statusEl.style.color = "yellow";
            } else {
                gpaBar.style.background = "red";
                statusEl.innerText = "DANGER";
                statusEl.style.color = "red";
            }
        }

        function createParticles(position, color) {
            const count = 10;
            const geom = new THREE.BoxGeometry(0.2, 0.2, 0.2);
            const mat = new THREE.MeshBasicMaterial({ color: color });
            
            for (let i = 0; i < count; i++) {
                const p = new THREE.Mesh(geom, mat);
                p.position.copy(position);
                
                // Random velocity
                p.userData = {
                    vel: new THREE.Vector3(
                        (Math.random() - 0.5) * 0.5,
                        (Math.random() - 0.5) * 0.5 + 0.2,
                        (Math.random() - 0.5) * 0.5
                    ),
                    life: 1.0
                };
                
                scene.add(p);
                particles.push(p);
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            // Player movement interpolation
            if (player) {
                player.position.x += (targetX - player.position.x) * 0.2;
                // Bobbing animation
                player.position.y = 0.5 + Math.sin(Date.now() * 0.01) * 0.1;
            }

            // Moving grid effect
            if (window.gridHelper) {
                window.gridHelper.position.z += speed;
                if (window.gridHelper.position.z > 0) {
                    window.gridHelper.position.z = -50;
                }
            }

            if (gameActive) {
                frameCount++;
                speed += 0.0001; // Slowly increase speed

                // Spawning logic
                if (frameCount % OBSTACLE_SPAWN_RATE === 0) {
                    spawnObstacle();
                }
                if (frameCount % (OBSTACLE_SPAWN_RATE * 1.5) === 0) {
                    spawnCollectible();
                }

                // Move Obstacles
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    const obs = obstacles[i];
                    obs.position.z += speed;

                    // Collision
                    if (obs.userData.active && obs.position.z > -1 && obs.position.z < 1) {
                        // Simple box collision
                        if (Math.abs(obs.position.x - player.position.x) < 0.8) {
                            obs.userData.active = false;
                            gpa -= 0.5;
                            createParticles(obs.position, 0xff0000);
                            scene.remove(obs);
                            obstacles.splice(i, 1);
                            updateUI();
                            
                            // Shake camera
                            camera.position.x = (Math.random() - 0.5);
                            setTimeout(() => camera.position.x = 0, 100);

                            if (gpa <= 0) {
                                gpa = 0;
                                updateUI();
                                gameOver();
                            }
                            continue;
                        }
                    }

                    // Cleanup
                    if (obs.position.z > 10) {
                        scene.remove(obs);
                        obstacles.splice(i, 1);
                    }
                }

                // Move Collectibles
                for (let i = collectibles.length - 1; i >= 0; i--) {
                    const col = collectibles[i];
                    col.position.z += speed;
                    col.rotation.y += 0.05; // Spin

                    // Collision
                    if (col.userData.active && col.position.z > -1 && col.position.z < 1) {
                        if (Math.abs(col.position.x - player.position.x) < 0.8) {
                            col.userData.active = false;
                            score += 100;
                            createParticles(col.position, 0x00ff00);
                            scene.remove(col);
                            collectibles.splice(i, 1);
                            updateUI();
                            continue;
                        }
                    }

                    // Cleanup
                    if (col.position.z > 10) {
                        scene.remove(col);
                        collectibles.splice(i, 1);
                    }
                }
            }

            // Particles animation
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.position.add(p.userData.vel);
                p.userData.vel.y -= 0.02; // Gravity
                p.userData.life -= 0.02;
                p.scale.setScalar(p.userData.life);
                
                if (p.userData.life <= 0) {
                    scene.remove(p);
                    particles.splice(i, 1);
                }
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Boot
        init();

    </script>
</body>
</html>
